name: Flutter iOS Build for AltStore

on:
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master
  workflow_dispatch: # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

jobs:
  build:
    runs-on: macos-latest
    timeout-minutes: 60

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.35.2'
          channel: 'stable'
          cache: true

      - name: Flutter Doctor
        run: flutter doctor -v

      - name: Clean project thoroughly
        run: |
          echo "ðŸ§¹ ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
          flutter clean
          rm -rf build
          rm -rf ios/Pods 
          rm -rf ios/Podfile.lock
          rm -rf ios/.symlinks
          rm -rf ios/Flutter/Flutter.framework
          rm -rf ~/Library/Developer/Xcode/DerivedData/*
          
      - name: Get Flutter dependencies
        run: |
          echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Flutter Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
          flutter pub get

      - name: Analyze Flutter code
        run: |
          echo "ðŸ” ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ð´Ð°..."
          flutter analyze --no-fatal-infos || echo "âš ï¸ Ð•ÑÑ‚ÑŒ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð´Ðµ, Ð½Ð¾ ÑÑ‚Ð¾ Ð½Ðµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸"

      - name: Setup CocoaPods
        run: |
          echo "ðŸŽ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CocoaPods..."
          cd ios
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÐµÑ€ÑÐ¸ÑŽ CocoaPods
          echo "Ð’ÐµÑ€ÑÐ¸Ñ CocoaPods: $(pod --version)"
          
          # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ CocoaPods
          echo "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ CocoaPods..."
          pod repo update
          
          # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼ Podfile
          echo "ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼ Podfile..."
          if pod install --repo-update --verbose --clean-install; then
            echo "âœ… ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Podfile ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
          else
            echo "âš ï¸ ÐžÑˆÐ¸Ð±ÐºÐ° Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼ Podfile, Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ð½Ð° Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹..."
            
            # Ð‘ÑÐºÐ°Ð¿ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Podfile
            cp Podfile Podfile.backup
            
            # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Podfile
            cp Podfile.minimal Podfile
            
            # ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð¸ Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ½Ð¾Ð²Ð°
            rm -rf Pods Podfile.lock
            
            echo "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Podfile..."
            if pod install --repo-update --verbose --clean-install; then
              echo "âœ… ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Podfile ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
            else
              echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð°Ð¶Ðµ Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Podfile"
              exit 1
            fi
          fi
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… pods:"
          ls -la Pods/ | head -10

      - name: Check dependencies status
        run: |
          echo "ðŸ“Š ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
          flutter pub outdated || true
          cd ios && pod outdated || true
          
      - name: Verify iOS project structure
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ iOS Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²:"
          ls -la ios/Runner.xcodeproj/project.pbxproj && echo "âœ… project.pbxproj Ð½Ð°Ð¹Ð´ÐµÐ½" || echo "âŒ project.pbxproj Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
          ls -la ios/Runner/Info.plist && echo "âœ… Info.plist Ð½Ð°Ð¹Ð´ÐµÐ½" || echo "âŒ Info.plist Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
          ls -la ios/Pods/ && echo "âœ… Pods ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹" || echo "âŒ Pods Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Firebase ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Firebase ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:"
          if [ -f "ios/Runner/GoogleService-Info.plist" ]; then
            echo "âœ… GoogleService-Info.plist Ð½Ð°Ð¹Ð´ÐµÐ½"
          else
            echo "âš ï¸ GoogleService-Info.plist Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚, ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð· ÐºÐ¾Ñ€Ð½Ñ..."
            if [ -f "google-service-info.json" ]; then
              cp google-service-info.json ios/Runner/GoogleService-Info.plist
              echo "âœ… GoogleService-Info.plist ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½"
            else
              echo "âŒ Ð¤Ð°Ð¹Ð» Firebase ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
            fi
          fi
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Flutter ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Flutter ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:"
          ls -la ios/Flutter/Generated.xcconfig && echo "âœ… Generated.xcconfig Ð½Ð°Ð¹Ð´ÐµÐ½" || echo "âŒ Generated.xcconfig Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ workspace
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° workspace:"
          ls -la ios/Runner.xcworkspace/ && echo "âœ… Workspace Ð½Ð°Ð¹Ð´ÐµÐ½" || echo "âŒ Workspace Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"

      - name: Build iOS IPA (unsigned for AltStore)
        run: |
          echo "ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ° IPA Ð´Ð»Ñ AltStore..."
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº ÑÐ±Ð¾Ñ€ÐºÐµ
          if [ ! -d "ios/Pods" ]; then
            echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: CocoaPods Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
            exit 1
          fi
          
          # ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð´ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ Ð´Ð»Ñ unsigned ÑÐ±Ð¾Ñ€ÐºÐ¸
          echo "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð´Ð»Ñ unsigned ÑÐ±Ð¾Ñ€ÐºÐ¸..."
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ xcconfig Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ unsigned ÑÐ±Ð¾Ñ€ÐºÐ¸
          cat > ios/Flutter/Unsigned.xcconfig << EOF
          #include "Generated.xcconfig"
          CODE_SIGN_IDENTITY=
          CODE_SIGNING_REQUIRED=NO
          CODE_SIGNING_ALLOWED=NO
          PROVISIONING_PROFILE_SPECIFIER=
          DEVELOPMENT_TEAM=
          EOF
          
          # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Release.xcconfig Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ unsigned Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
          cp ios/Flutter/Release.xcconfig ios/Flutter/Release.xcconfig.backup
          cp ios/Flutter/Unsigned.xcconfig ios/Flutter/Release.xcconfig
          
          # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¼ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð¼
          echo "Ð—Ð°Ð¿ÑƒÑÐº flutter build ipa..."
          if flutter build ipa --release --no-codesign --verbose; then
            echo "âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° IPA Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
          else
            echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸ IPA, Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´..."
            
            # Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
            cp ios/Flutter/Release.xcconfig.backup ios/Flutter/Release.xcconfig
            
            # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ iOS app bundle Ð²Ð¼ÐµÑÑ‚Ð¾ IPA
            echo "ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ iOS app bundle..."
            if flutter build ios --release --no-codesign --verbose; then
              echo "âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° iOS app Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
              
              # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ IPA Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¸Ð· app bundle
              echo "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ IPA Ð¸Ð· app bundle..."
              mkdir -p build/ios/ipa
              cd build/ios/iphoneos
              
              # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ .app Ñ„Ð°Ð¹Ð»
              APP_NAME=$(find . -name "*.app" -type d | head -1)
              if [ -n "$APP_NAME" ]; then
                echo "ÐÐ°Ð¹Ð´ÐµÐ½ app bundle: $APP_NAME"
                
                # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð´Ð»Ñ IPA
                mkdir -p Payload
                cp -r "$APP_NAME" Payload/
                
                # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ IPA Ñ„Ð°Ð¹Ð»
                zip -r "../ipa/taste_smoke_ios.ipa" Payload/
                echo "âœ… IPA ÑÐ¾Ð·Ð´Ð°Ð½ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ"
                
                cd ../../..
              else
                echo "âŒ App bundle Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
                exit 1
              fi
            else
              echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸ iOS app"
              echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
              ls -la ios/
              ls -la build/ || echo "ÐŸÐ°Ð¿ÐºÐ° build Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð°"
              exit 1
            fi
          fi
          
      - name: Verify IPA creation
        run: |
          echo "âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ IPA..."
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ build Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
          echo "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° build/:"
          find build/ -type f -name "*.ipa" -o -name "*.app" 2>/dev/null || echo "ÐÐµÑ‚ IPA Ð¸Ð»Ð¸ APP Ñ„Ð°Ð¹Ð»Ð¾Ð²"
          
          if [ -d "build/ios/ipa" ]; then
            echo "ÐŸÐ°Ð¿ÐºÐ° IPA Ð½Ð°Ð¹Ð´ÐµÐ½Ð°:"
            ls -la build/ios/ipa/
            
            if ls build/ios/ipa/*.ipa 1> /dev/null 2>&1; then
              echo "IPA Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹:"
              for ipa in build/ios/ipa/*.ipa; do
                echo "Ð¤Ð°Ð¹Ð»: $ipa"
                file "$ipa"
                echo "Ð Ð°Ð·Ð¼ÐµÑ€: $(du -h "$ipa" | cut -f1)"
                
                # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ IPA
                echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ IPA:"
                unzip -l "$ipa" | head -20
              done
            else
              echo "âŒ IPA Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð² Ð¿Ð°Ð¿ÐºÐµ"
              exit 1
            fi
          else
            echo "âŒ ÐŸÐ°Ð¿ÐºÐ° build/ios/ipa Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
            echo "ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° build/:"
            find build/ -type f 2>/dev/null || echo "ÐŸÐ°Ð¿ÐºÐ° build Ð¿ÑƒÑÑ‚Ð° Ð¸Ð»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
            exit 1
          fi

      - name: Upload IPA artifact
        uses: actions/upload-artifact@v4
        with:
          name: taste-smoke-ios-altstore
          path: build/ios/ipa/*.ipa
          retention-days: 30

      - name: Debug build failure
        if: failure()
        run: |
          echo "ðŸ” Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑÐ±Ð¾Ñ€ÐºÐ¸..."
          
          echo "=== Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° ==="
          ls -la ios/
          
          echo "=== Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° build ==="
          find build/ -type f 2>/dev/null || echo "ÐŸÐ°Ð¿ÐºÐ° build Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
          
          echo "=== Xcode Ð¿Ñ€Ð¾ÐµÐºÑ‚ ==="
          ls -la ios/Runner.xcodeproj/
          ls -la ios/Runner.xcworkspace/ 2>/dev/null || echo "Workspace Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
          
          echo "=== CocoaPods ==="
          ls -la ios/Pods/ 2>/dev/null || echo "Pods Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
          cat ios/Podfile.lock | head -20 2>/dev/null || echo "Podfile.lock Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
          
          echo "=== Flutter ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ==="
          ls -la ios/Flutter/
          cat ios/Flutter/Generated.xcconfig 2>/dev/null || echo "Generated.xcconfig Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
          
          echo "=== ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ ÑÐ±Ð¾Ñ€ÐºÐ¸ ==="
          find . -name "*.log" -mtime -1 2>/dev/null | head -5 | xargs tail -50 2>/dev/null || echo "Ð›Ð¾Ð³Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"

      - name: Upload build logs (on failure)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: build-logs-debug
          path: |
            ios/Pods/
            build/
            ios/Flutter/
            ios/Runner.xcodeproj/
            ios/Podfile*
          retention-days: 7
